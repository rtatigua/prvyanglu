<div class="player-detail-container">
  @if (playerSignal(); as player) {
    <div class="player-header">
      <button class="back-btn" (click)="goBack()">← Back to Players</button>
      <div class="player-info">
        <div class="avatar">
          @if (player.avatar && isEmoji(player.avatar)) {
            <div class="emoji-avatar">{{ player.avatar }}</div>
          } @else if (player.avatar && !isEmoji(player.avatar)) {
            <img [src]="player.avatar" alt="{{ player.nickname }}" />
          } @else {
            <span class="emoji-avatar">⚔️</span>
          }
        </div>
        <div class="info-text">
          <h2>{{ player.nickname }}</h2>
          <p class="level">{{ playerLevelData().levelTitle }}</p>
        </div>
      </div>
    </div>

    <div class="quest-section">
      <h3>Assigned Quests</h3>
      <app-quest-list
        [quests]="assignedQuests()"
        [actionButton]="true"
        [actionLabel]="'Mark Complete'"
        (onAction)="completeQuest($event)">
      </app-quest-list>

      <div class="assign-quest">
        <h4>Assign New Quest</h4>
        @if (allQuests() && allQuests().length) {
          <div>
            <select #questSelect>
              @for (q of allQuests(); track q.id) {
                <option [value]="q.id" [disabled]="player && player.assignedQuests.includes(q.id)">{{ q.title }}</option>
              }
            </select>
            <button class="btn-add-player" (click)="assignQuest(questSelect.value)" [disabled]="!player">Assign</button>
          </div>
        } @else {
          <p class="info">No quests available to assign.</p>
        }
      </div>

      @if (assignedQuests().length) {
        <div class="manage-assigned">
          <h4>Manage Assigned Quests</h4>
          <ul>
            @for (q of assignedQuests(); track q.id) {
              <li>
                {{ q.title }}
                <button class="btn-remove" (click)="unassignQuest(q.id)">Unassign</button>
              </li>
            }
          </ul>
        </div>
      }
    </div>

    <div class="quest-section">
      <h3>Completed Quests</h3>
      <app-quest-list
        [quests]="completedQuests()"
        [actionButton]="true"
        [actionLabel]="'Mark Incomplete'"
        (onAction)="uncompleteQuest($event)">
      </app-quest-list>
    </div>
  } @else {
    <p class="error">Player not found.</p>
  }
</div>
