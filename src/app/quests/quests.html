<div class="quests-container">
  <div class="quests-header">
    <h1>ğŸ“œ Quests</h1>
    <p class="quest-count">Total Quests: {{ questCount() }}</p>
  </div>

  <app-search [(searchQuery)]="searchTerm"></app-search>

  <button class="btn-add-quest" (click)="addQuest()">
    <span class="icon">â•</span> Create New Quest
  </button>

  @if (showForm()) {
    <div class="new-quest-form">
      <form [formGroup]="questForm" (ngSubmit)="createQuest()">
        <div>
          <label for="title">Title</label>
          <input id="title" formControlName="title" />
        </div>

        <div>
          <label for="description">Description</label>
          <textarea id="description" formControlName="description"></textarea>
        </div>

        <div>
          <label for="xp">XP</label>
          <input id="xp" formControlName="xp" type="number" inputmode="numeric" pattern="\d*" min="1" step="1" />
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-add-quest" [disabled]="!questForm.valid">Create</button>
          <button type="button" (click)="showForm.set(false)">Cancel</button>
        </div>
      </form>
    </div>
  }

  <div class="quests-grid">
    @if (filteredQuests().length) {
      @for (quest of filteredQuests(); track quest.id) {
        <div class="quest-card" (click)="goToDetail(quest.id)">
          <div class="quest-header-section">
            <h3>{{ quest.title }}</h3>
            <span class="xp-badge">{{ quest.xp }} XP</span>
          </div>

          <p class="quest-description" [class.clamped]="!isExpanded(quest.id)">{{ quest.description }}</p>

          <div class="quest-meta">
            <span class="xp-badge">{{ quest.xp }} XP</span>

            <div class="actions">
              <button class="btn-toggle" (click)="$event.stopPropagation(); toggleExpand(quest.id)">
                {{ isExpanded(quest.id) ? 'Show less' : 'Show more' }}
              </button>

              <button class="btn-delete" (click)="$event.stopPropagation(); deleteQuest(quest.id)">Delete</button>
            </div>
          </div>
        </div>
      }
    } @else {
      <div class="empty-state">
        <p>ğŸœï¸ No quests available yet.</p>
        <p>Click "Create New Quest" to get started!</p>
      </div>
    }
  </div>
</div>